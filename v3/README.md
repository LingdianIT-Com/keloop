# 快跑者开放接口 v3 版本说明文档

- [前言](#前言)
- [接口使用流程](#接口使用流程)
- [接口简述](#接口简述)
- [基本约定](#基本约定)
- [接口说明](#接口说明)
- [创建配送订单接口](#创建配送订单接口)
- [撤销配送订单接口](#撤销配送订单接口)
- [评论配送订单接口](#评论配送订单接口)
- [获取配送订单信息接口](#获取配送订单信息接口)
- [快捷查看配送订单链接](#快捷查看配送订单链接)
- [获取配送订单操作记录接口](#获取配送订单操作记录接口)
- [获取配送员最新坐标接口](#获取配送员最新坐标接口)
- [订单状态变更后回调](#订单状态变更后回调)
- [附：签名与验签说明](#附签名与验签说明)
    + [请求参数签名](#请求参数签名)
        - [1. 参数筛选](#1-参数筛选)
        - [2. 参数排序](#2-参数排序)
        - [3. 参数拼接](#3-参数拼接)
        - [4. 签名](#4-签名)
    + [返回参数验证签名](#返回参数验证签名)

## 前言

- 快跑者开放接口 **v3** 版本相对于 v2 版本大大简化了对接的流程，降低了对接难度（如果说对接 v2 版本接口的难度是 10，那么对接 v3 版本接口的难度则约为 1），v3 版本的接口实现逻辑和 v2 版本完全不同，强烈建议使用 v3 版本进行对接。

- 欢迎加入快跑者开放接口对接讨论 QQ 群：`438529770`

## 接口使用流程

1. 在快跑者 [开发者中心](http://www.keloop.cn/home/open/index) 注册开发者账号，完善开发者相关信息，并绑定微信（申请通过会通过微信进行通知）， 申请 **开发密钥** 和 **签名秘钥**，申请通过后即可进行开发；

2. 注册快跑者 **团队后台** 账号，在「系统模块 - 第三方接口」页面查看团队的 `team_token`；

3. 调用 **创建订单接口** 向快跑者配送团队发送订单；

4. [可选]可调用获取订单信息接口获取订单的详细信息；

5. [可选]可调用获取订单进程接口获取订单的配送进程；

6. [可选]可调用获取配送员最新坐标接口获取配送员的最新坐标；

7. [可选]可调用撤销订单接口撤销配送订单。

## 接口简述

简述：本文档系快跑者第三方开放接口说明文档（**v3 版**），快跑者开放接口是向拥有开发能力的第三方系统开放订单操作能力：第三方系统可通过快跑者开放接口向快跑者系统快捷发送配送订单，并可对订单进行撤销、查看等相关操作。

使用时间：`2017-08-26` 起

主要开放能力：

- 创建订单：`createOrder`

- 撤销订单：`cancelOrder`

- 获取订单信息：`getOrderInfo`

- 获取订单进程：`getOrderLog`

- 获取配送员最新坐标：`getCourierTag`

## 基本约定

在文档描述过程中，为避免因描述模糊而致使开发者理解错误，特对部分关键词做如下约定：

- **第三方系统**：接口的使用方，调用本文档接口的系统或平台（如餐饮外卖平台，本地电商平台）

- **快跑者系统**：接口的提供方，向第三方系统开放订单操作能力

- **第三方订单**：第三方系统的订单

- **配送订单**：快跑者系统的订单

注：**第三方订单和配送订单的关系**：开发者在调用创建配送订单接口时，需要传递一些参数，如：订单内容、订单标识、订单备注等，可以将第三方系统订单的对应字段来赋值这些参数。

## 接口说明

快跑者开放接口的返回数据为 **JSON** 格式，由以下三个字段组成：

- **code**：状态码，取值有 200，204；200 表示接口调用成功， 204 表示接口调用失败

- **message**：错误信息，当接口调用失败（状态码为 204）时，返回的错误提示信息

- **data**：返回数据，接口调用成功（状态码为 200）时返回的数据

___

**注：**

+ PHP 开发者可直接获取并使用 [Keloop-PHP-SDK 及 Demo](https://github.com/LingdianIT-Com/keloop/tree/master/v3/Keloop-PHP-SDK) 简化开放流程；

+ 为保证接口调用安全，请求接口需对请求参数进行签名，开发者可参考 [签名与验签说明](#附签名与验签说明) 自由编写签名代码；

+ 调用创建订单接口成功创建配送订单后，系统会返回配送订单单号：`trade_no`，请开发者保存好，用于后续查询和操作订单；

## 创建配送订单接口

**简要描述：** 第三方系统可直接向快跑者系统创建配送订单。

**请求 URL：** `http://www.keloop.cn/api/tp3/createOrder`

**请求方式：** POST

**请求参数：**

| 参数名 | 必选 | 类型 | 默认值 | 说明 |
|:----:|:---:|:-----:|:-----:|:-----:|
| `dev_key` | 是 | `string` | 无 | 开发者中心的开发密钥 |
| `shop_id` | **是** | `int` | 无 | 第三方系统中的商户 ID，如：`35` |
| `shop_name` | **是** | `string` | 无 | 第三方系统中的商户名称，如：`廖记棒棒鸡` |
| `shop_tel` | **是** | `string` | 无 | 第三方系统中的商户电话，如：`18280094444` |
| `shop_address` | **是** | `string` | 无 | 第三方系统中的商户地址，如：`四川成都金牛区蓝海天地 1 栋 421 室` |
| `shop_tag` | **是** | `string` | 无 | 第三方系统中的商户坐标（火星坐标），如：`104.112765,30.214386` |
| `team_token` |  是  | `string` | `无` | 配送订单指定的配送团队，可在「快跑者团队端 - 系统模块 - 第三方接口」页面中查看  |
| `note` |  否  | `string` | `''` | 自定义参数，快跑者系统调用回调地址时会带上该参数 |
| `order_content` |  否  | `string` | `''` | 订单订单内容，如：`1份烧白开(100x1)` |
| `order_note` |  否  | `string` | `''` |  订单备注，如：`麻辣一点` |
| `order_mark` |  否  | `string` | `''` |  订单标识，如：`12` |
| `order_from` |  否  | `string` | `''` |  订单来源，如：`美团外卖` |
| `order_send` |  否  | `string` | `''` |  订单送达时间，如：`下午六点钟之前送达` |
| `order_no` |  是  | `string` | `''` |  订单单号（必须唯一） |
| `order_time` |  否  | `string` | `''` |  订单下单时间，如：`2016-12-31 23:59:59` |
| `order_photo` |  否  | `string` | `''` |  订单图片路径 |
| `order_price` |  否  | `float` | `0.00` |  订单货物的总价金额，如：`9.99` |
| `customer_name` |  否  | `string` | `''` |  订单客户（对应配送订单的收单人）名字，如：`张三` |
| `customer_sex` |  否  | `string` | `''` |  订单客户性别，如：`男`，`女`，`保密` |
| `customer_tel` |  否  | `string` | `''` |  订单客户电话，如：`18280097777` |
| `customer_address` |  否  | `string` | `''` |  订单客户地址，如：`四川成都金牛区金卉院` |
| `customer_tag` |  否  | `string` | `''` |  订单客户坐标（火星坐标），如：`104.012765,30.714386`  |
| `pay_status` |  否  | `int` | `0` |  订单支付方式：0 表示已支付、1 表示货到付款  |
| `pay_type` |  否  | `int` | `3` |  配送订单费用的支付方式，1 表示在线支付，2 表示事后结算，3 表示储备金支付，当团队未设置本商户的储值模式或无法计算配送费时，自动修改为事后结算,当订单发往商户时，同时team_id也为空，自动修改为事后结算 |
| `pay_fee` |  否  | `float` | `0.00` |  配送订单的配送费用  |
| `expire_time` | **是** | `int` | 无 | 过期时间，时间戳格式（10 位数字），如：1477483702 |
| `sign` | **是** | `string` | 无 | 参数签名，生成规则请参考 **签名与验签说明** |

**备注：**

- `order_content` 参数如果符合正则规则：`/(.*\([\d\.]+x[\d\.]+\),)+/`，则在订单详情页面会自动以表格的形式展示，如：`五块钱的麻辣烫(5x1),七块钱的麻辣烫(7x1),八块钱的麻辣烫(8x1)`

- `order_no` 参数表示订单单号，该参数在第三方系统中必须唯一，创建配送订单时，快跑者系统会对其进行查重避免重复发单。

- 快跑者配送订单中的商户坐标和客户坐标使用的是火星坐标，所以，如果第三方系统使用的是百度坐标，请在调用接口之前先进行坐标转换

**返回示例**

- 调用成功示例
```
{
    "code": 200,
    "message": "",
    "data": {
        "trade_no": "16120709314700002"
    }
}
```
- 调用失败示例
```
{
    "code": 204,
    "message": "该订单已存在，请勿重复提交",
    "data": []
}
```

**调用成功返回参数说明：**

| 返回参数名 | 类型 | 说明 |
|:-----:|:-----:|:-----:|
| `trade_no` | `string` | 配送订单的订单单号，可使用单号查询订单状态及撤销配送订单 |

## 撤销配送订单接口

**简要描述：** 第三方系统可撤销快跑者的配送订单（注：只有处于未发单、未抢单或未接单状态的配送订单才可被撤销）。

**请求 URL：** `http://www.keloop.cn/api/tp3/cancelOrder`

**请求方式：** POST

**请求参数：**

| 参数名 | 必选 | 类型 | 说明 |
|:----:|:---:|:-----:|:-----:|
| `dev_key` | 是 | `string` | 开发者中心的 `dev_key` |
| `trade_no` |  **是**  | `string` |  配送订单的订单单号，如：`16120709314700002` |
| `expire_time` | **是** | `int` | 过期时间，时间戳格式（10 位数字），如：`1477483702` |
| `sign` | **是** | `string` | 参数签名，生成规则请参考 **签名与验签说明** |

**返回示例**

- 调用成功示例
```
{
    "code": 200,
    "message": "",
    "data": []
}
```
- 调用失败示例
```
{
    "code": 204,
    "message": "只有待发单、待抢单和待接单的订单才可被撤销",
    "data": [ ]
}
```

**返回参数说明：**

略

## 评论配送订单接口

**简要描述：** 开发者评价已送达的快跑者配送订单（注：只有处于已送达状态的配送订单才可评价）。

**请求 URL：** `http://www.keloop.cn/api/tp2/commentOrder`

**请求方式：** POST

**请求参数：**

| 参数名 | 必选 | 类型 | 说明 |
|:----:|:---:|:-----:|:-----:|
| `dev_key` | 是 | `string` | 开发者中心的 `dev_key` |
| `trade_no` |  **是**  | `string` |  配送订单的订单单号，如：`16120709314700002` |
| `score` |  **是**  | `string` |  评论分数，可选：1,2,3,4,5  |
| `content` |  **是**  | `string` |  评论内容  |
| `expire_time` | **是** | `int` | 过期时间，时间戳格式（10 位数字），如：`1477483702` |
| `sign` | **是** | `string` | 参数签名，生成规则请参考 **签名与验签说明** |

**返回示例**

- 调用成功示例
```
{
    "code": 200,
    "message": "",
    "data": []
}
```
- 调用失败示例
```
{
    "code": 204,
    "message": "只有已送达的订单才能评论",
    "data": [ ]
}
```

**返回参数说明：**

略

## 获取配送订单信息接口

**简要描述：** 第三方系统可根据配送单号获取配送订单的详细信息

**请求 URL：** `http://www.keloop.cn/api/tp3/getOrderInfo`

**请求方式：** GET

**请求参数：**

| 参数名 | 必选 | 类型 | 说明 |
|:----:|:---:|:-----:|:-----:|
| `dev_key` | 是 | `string` | 开发者中心的 `dev_key` |
| `trade_no` |  **是**  | `string` |  配送订单的订单单号，如：`16120709314700002` |
| `expire_time` | **是** | `int` | 过期时间，时间戳格式（10 位数字），如：`1477483702` |
| `sign` | **是** | `string` | 参数签名，生成规则请参考 **签名与验签说明** |

**返回示例**

- 调用成功示例
```
{
    "code": 200, 
    "message": "", 
    "data": {
        "order_content": "1份烧白开(100x1),1份拉面(18x1)", 
        "order_note": "不要太辣了", 
        "order_mark": "外卖订单", 
        "order_from": "三餐美食 - 兰州拉面", 
        "order_send": "下午六点钟之前送达", 
        "order_time": "2016-12-31 23:59:59", 
        "order_photo": "http://a4.att.hudong.com/38/47/19300001391844134804474917734_950.png", 
        "customer_name": "郝美丽", 
        "customer_sex": "男", 
        "customer_address": "成都市金牛区蓝海天地1栋421", 
        "customer_tag": "104.081909,30.779741", 
        "get_name": "一家商户", 
        "get_sex": "保密", 
        "get_address": "成都理工大学哈哈哈", 
        "get_tel": "18280094727", 
        "get_tag": "104.01233,30.705693", 
        "customer_tel": "18288888888", 
        "order_no": "121531546", 
        "order_price": "99.99", 
        "pay_status": "1", 
        "pay_type": "2", 
        "pay_fee": "6.66", 
        "send_time": "2017-06-06 16:54:52", 
        "update_time": "2017-06-07 11:13:47", 
        "status": "6", 
        "trade_no": "17060616545200001", 
        "courier_name": "徐哈哈1", 
        "courier_tel": "18280094727", 
        "team_name": "本地团队", 
        "team_tel": "18280094727", 
        "group_name": "测试群"
    }
}
```
- 调用失败示例
```
{
    "code": 204,
    "message": "该订单不存在",
    "data": [ ]
}
```

**调用成功返回参数说明：**

| 返回参数名 | 类型 | 说明 |
|:-----:|:-----:|:-----:|
| `order_content` | `string` | 订单内容 | 
| `order_note` | `string` | 订单备注 | 
| `order_mark` | `string` | 订单标识 | 
| `order_from` | `string` | 订单来源 | 
| `order_send` | `string` | 订单送达时间 | 
| `order_time` | `string` | 第三方订单下单时间 | 
| `order_photo` | `string` | 订单图片路径 | 
| `order_no` | `string` | 第三方订单单号 | 
| `pay_status` | `string` | 第三方订单的支付状态，0 表示已经支付，1 表示货到付款 | 
| `order_price` | `string` | 订单价值金额 | 
| `customer_name` | `string` | 订单客户（对应配送订单的收单人）名字 | 
| `customer_sex` | `string` | 订单客户性别 | 
| `customer_address` | `string` | 订单客户地址 | 
| `customer_tag` | `string` | 订单客户坐标 | 
| `customer_tel` | `string` | 订单客户电话 | 
| `get_name` | `string` | 取单名字 | 
| `get_sex` | `string` | 取单性别 | 
| `get_address` | `string` | 取单地址 | 
| `get_tel` | `string` | 取单电话 | 
| `get_tag` | `string` | 取单坐标 | 
| `pay_type` | `string` | 配送费的支付方式，2 表示事后结算，3 表示储备金支付 | 
| `pay_fee` | `string` | 配送费金额 | 
| `send_time` | `string` | 配送订单的发单时间 | 
| `update_time` | `string` | 配送订单的更新时间 | 
| `status` | `string` | 配送订单状态：1：待发单，2：待抢单，3：待接单，4：取单中，5：送单中，6：已送达，7：已撤销 | 
| `trade_no` | `string` | 配送订单单号 | 
| `courier_name` | `string` | 接单配送员的名字 | 
| `courier_tel` | `string` | 接单配送员的电话 | 
| `team_name` | `string` | 配送团队名字 | 
| `team_tel` | `string` | 配送团队电话 | 
| `group_name` | `string` | 所属配送群的名字 |

## 快捷查看配送订单链接

**简要描述：** 开发者可根据配送订单单号拼接一个固定格式的 `url` 地址来快捷访问配送订单信息及订单进程状态。

**说明：** 为让快跑者开放接口更为简便易用，第三方系统可使用直接跳转 URL 的方式来展示订单详情及相关信息，开发者调用下单接口后，快跑者会返回订单的单号（如：`16122813523200001`），使用该单号可拼接一个固定格式的 URL 链接（如：`http://www.keloop.cn/show_order/16122813523200001`），直接访问该链接即可查看该订单的详情和进程。

## 获取配送订单操作记录接口

**简要描述：** 第三方系统可根据配送单号获取配送订单的操作记录。

**请求 URL：** `http://www.keloop.cn/api/tp3/getOrderLog`

**请求方式：** GET

**请求参数：**

| 参数名 | 必选 | 类型 | 说明 |
|:----:|:---:|:-----:|:-----:|
| `dev_key` | 是 | `string` | 开发者中心的 `dev_key` |
| `trade_no` |  **是**  | `string` |  配送订单的订单单号，如：`16120709314700002` |
| `sign` | **是** | `string` | 加密密钥，按支付宝密钥排序，可参考**签名与验签说明** |
| `expire_time` | **是** | `int` | 过期时间，时间戳格式，如：`1477483702` |

**返回示例**

- 调用成功示例
```
{
    "code": 200, 
    "message": "", 
    "data": [
        {
            "time": "2017-06-06 16:57:54", 
            "role": 2, 
            "title": "发入抢单群（本地团队-测试群）", 
            "name": "一家商户", 
            "tel": "18280094727"
        }, 
        {
            "time": "2017-06-07 11:13:21", 
            "role": 1, 
            "title": "被抢单（被接单）", 
            "name": "徐哈哈1", 
            "tel": "18280094727"
        }, 
        {
            "time": "2017-06-07 11:16:16", 
            "role": 1, 
            "title": "已取单", 
            "name": "徐哈哈1", 
            "tel": "18280094727"
        }, 
        {
            "time": "2017-06-07 11:16:27", 
            "role": 1, 
            "title": "已送达", 
            "name": "徐哈哈1", 
            "tel": "18280094727"
        }
    ]
}
```
- 调用失败示例
```
{
    "code": 204,
    "message": "您没有操作权限",
    "data": [ ]
}
```

**调用成功返回参数说明：**

| 返回参数名 | 类型 | 说明 |
|:-----:|:-----:|:-----:|
| `time` | `string` | 操作时间 | 
| `role` | `string` | 操作者角色，1：配送员，2：商户，3：团队 | 
| `name` | `string` | 操作者名字 | 
| `tel` | `string` | 操作者的电话号码 | 
| `title` | `string` | 操作描述 | 

## 获取配送员最新坐标接口

**简要描述：** 第三方系统可根据配送单号获取该订单的配送员的最新坐标。

**注意：**

- 快跑者配送员坐标使用的是火星坐标系！
- 只有在订单状态处于取单中和送单中时才可查看配送员的坐标！

**请求 URL：** `http://www.keloop.cn/api/tp3/getCourierTag`

**请求方式：** GET

**请求参数：**

| 参数名 | 必选 | 类型 | 说明 |
|:----:|:---:|:-----:|:-----:|
| `dev_key` | 是 | `string` | 开发者中心的 `dev_key` |
| `trade_no` |  **是**  | `string` |  配送订单的订单单号，如：`16120709314700002` |
| `sign` | **是** | `string` | 加密密钥，按支付宝密钥排序，可参考**签名与验签说明** |
| `expire_time` | **是** | `int` | 过期时间，时间戳格式，如：1477483702 |

**返回示例**

- 调用成功示例
```
{
    "code": 200, 
    "message": "获取成功!", 
    "data": {
        "gate_time": "2017-05-25 16:59:21", 
        "latitude": "30.71490499025135", 
        "longitude": "104.01535454330507"
    }
}
```
- 调用失败示例
```
{
    "code": 204,
    "message": "您没有查看权限",
    "data": [ ]
}
```

**调用成功返回参数说明：**

| 返回参数名 | 类型 | 说明 |
|:-----:|:-----:|:-----:|
| `gate_time` | `string` | 配送员在该坐标时的时间 | 
| `longitude` | `string` | 坐标经度 | 
| `latitude` | `string` | 坐标纬度 | 

## 订单状态变更后回调

**简要描述：** 第三方系统调用创建订单接口后会在快跑者系统中创建一个配送订单，配送单被配送员接单（抢单）、送达或被商户或团队撤销时均会向第三方系统回调通知订单改变状态。

**注意：** 

- 如果开发者未在 [快跑者开放中心](http://www.keloop.cn/home/open/index) 设置回调地址，则不会进行回调
- 第三方系统接收到回调请求，并处理好业务逻辑之后请返回 `success` 字符串，否则快跑者系统将认定本次回调请求失败，于是将向第三方系统进行重复多次回调

**请求 URL：** 本次请求是由快跑者系统向第三方系统发起，请求地址为开发者在快跑者 [开放中心](http://www.keloop.cn/home/open/index) 设置的回调地址（所以，请注意一定要设置回调地址！）。

**请求方式：** POST

**请求参数：**

| 参数名 | 类型 | 说明 |
|:----:|:-----:|:-----:|
| `expire_time` | `int` | 请求的过期时间，时间戳格式，如：1477483702 |
| `sign` | `string` | 加密密钥，按支付宝密钥排序，可参考**签名与验签说明**，主要用于验证请求权限 |
| `trade_no` | `string` |  状态发生改变的配送订单的订单单号  |
| `state` | `int` |  配送订单状态码，可选值为 4,5,6,7，具体参考下面的订单状态码说明表  |
| `note` | `string` | 创建订单时传递自定义参数 `note` |
| `courier` | `string` | 配送员的名字 |
| `tel` | `string` |  配送员的电话号码  |
| `update_time` | `string` |  配送订单状态的改变时间，如：`2017-01-01 01:01:01`  |

**参数示例：**
```
{
    "trade_no": "17060711244400001", 
    "state": "6", 
    "tel": "18280094727", 
    "update_time": "2017-06-07 11:36:14", 
    "expire_time": "1496806651", 
    "courier": "徐哈哈1", 
    "note": "", 
    "sign": "8cd619d3271e204d1e2d80babad78fd3"
}
```

**订单状态码说明：**

| 状态码 | 说明 | 说明 |
|:----:|:-----:|:-----:|
| `4` | 取单中（已接单/已抢单） | 发往配送群的订单被配送员抢单，或发往配送员的订单被配送员接单 |
| `5` | 送单中（已取单） | 配送员已从取件处领取货物，准备送往收件人 |
| `6` | （已送达） | 配送员已将货物送达到收件人 |
| `7` | （已撤销） | 商户或团队撤销订单 |

## 附：签名与验签说明

PHP 开发者可直接使用或借鉴快跑者 [Keloop-PHP-SDK](https://github.com/LingdianIT-Com/keloop/tree/master/v3/Keloop-PHP-SDK)，其他语言开发者可根据以下签名规则自己编写签名方法，具体的签名流程如下：

### 请求参数签名

示例：使用以下 `dev_key` 和 `dev_secret` 来签名请求参数：
```
{
    "dev_key": "9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW",
    "dev_secret": "F0A7C215592E0BEBA900E7DE1BED833D",
}
```

#### 1. 参数筛选

获取所有请求参数（不包括字节类型参数，如文件、字节流），剔除参数名为 `sign`、`sign_type`、`key` 的参数及参数值为 `''` 或 `null` 的参数。

**注意：** 请不要将 `dev_secret` 参数直接加入到请求参数中。

假定需要请求的参数如下：

```
{
    "name": "张三", 
    "sex": 1, 
    "nick_name": "", 
    "money": null, 
    "sign": "test_sign", 
    "expire_time": 1582381342, 
    "dev_key": "9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW"
}
```

则根据规则经过参数筛选之后的参数为：

```
{
    "name": "张三", 
    "sex": 1, 
    "expire_time": 1582381342, 
    "dev_key": "9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW"
}
```

#### 2. 参数排序

按照参数名第一个字符的键值 ASCII 码递增排序（字母升序排序），如果遇到相同字符则按照第二个字符的键值 ASCII 码递增排序，以此类推。

经过参数排序之后参数为：

```
{
    "dev_key": "9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW"
    "expire_time": 1582381342, 
    "name": "张三", 
    "sex": 1
}
```

#### 3. 参数拼接

1. 将排序后的参数名与参数值，组合成“参数名=参数值”的格式，并把这些参数用 **&** 字符连接起来，此时生成的字符串为最初的待签名字符串。经过参数拼接之后的最初待签名字符串为：

    ```
    dev_key=9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW&expire_time=1582381342&name=张三&sex=1
    ```
    
2. 然后将最初的待签名字符串和 `dev_secret` 的值 **直接** 拼接到一起，生成最终的待签名字符串：

    ```
    # 最初的待签名字符串：
    dev_key=9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW&expire_time=1582381342&name=张三&sex=1
    # 拼接 api_secret 后的最终的待签名字符串：
    dev_key=9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW&expire_time=1582381342&name=张三&sex=1F0A7C215592E0BEBA900E7DE1BED833D
    ```

#### 4. 签名

使用 md5(）方法对最终的待签名字符串进行签名：

```
md5('dev_key=9LIYXQ2PTKSZNGUJHHESXP7V1COHY2TW&expire_time=1582381342&name=张三&sex=1F0A7C215592E0BEBA900E7DE1BED833D')
# 结果为：
0277c2e7e061cfd594b318f1580608e9
```

因此，请求参数的签名结果（即 `sign` 参数的值）为：`0277c2e7e061cfd594b318f1580608e9`

### 返回参数验证签名

开发者在快跑者 [开发者中心](http://www.keloop.cn/home/open/index) 可设置一个回调地址（`notify_url`），当快跑者订单的状态发生变化时，会回调该地址，请开发者对快跑者回调传递的参数进行验证签名，以保证接口调用安全。

验证签名，需要将获取到的参数进行签名（参考上面的签名流程），然后再对比 `sign` 值是否相等，由此进行参数签名验证！
